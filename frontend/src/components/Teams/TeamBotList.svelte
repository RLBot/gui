<script lang="ts">
    import { dndzone } from "svelte-dnd-action";
    import { flip } from "svelte/animate";
    import closeIcon from "../../assets/close.svg";
    import defaultIcon from "../../assets/rlbot_mono.png";
    import type { DraggablePlayer } from "../..";
    const flipDurationMs = 100;
    function handleSort(e: any) {
        items = e.detail.items;
    }
    let { items = $bindable() }: { items: DraggablePlayer[] } = $props();
    function remove(id: number): any {
        items = items.filter((x) => x.id !== id);
    }
</script>

<div class="teamBotList">
    <p
        class="placeholder"
        style={items.length == 0
            ? "margin-top:.6rem;"
            : "opacity: 0;z-index: -999"}
    >
        Drop bots here...
    </p>
    <div
        class="bots"
        use:dndzone={{
            items,
            flipDurationMs,
            dropTargetStyle: {},
            dropTargetClasses: ["dropTarget"],
        }}
        onconsider={handleSort}
        onfinalize={handleSort}
    >
        {#each items as bot (bot.id)}
            <div class="bot" animate:flip={{ duration: flipDurationMs }}>
                <img src={bot?.icon || defaultIcon} alt="icon" />
                <p>{bot?.displayName}</p>
                <div style="flex: 1;"></div>
                <button class="close" onclick={remove.bind(null, bot.id)}>
                    <img src={closeIcon} alt="X" />
                </button>
            </div>
        {/each}
    </div>
</div>

<style>
    * {
        user-select: none;
        -webkit-user-select: none;
    }
    .teamBotList {
        padding: 0.6rem;
        overflow: auto;
        height: 100%;
        min-height: 4rem;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    .placeholder {
        position: absolute;
        transition: 100ms;
    }
    .bots {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 100%;
    }
    .bot {
        display: flex;
        align-items: center;
        background-color: var(--background-alt);
        height: 2.25rem;
        padding: 0.2rem;
        gap: 0.5rem;
        border-radius: 0.2rem;
    }
    .bot img {
        height: 2rem;
        width: auto;
    }
    .close {
        background-color: transparent;
        height: 100%;
        padding: 0;
    }
    .close img {
        height: 100%;
        width: auto;
        filter: invert();
    }
</style>
